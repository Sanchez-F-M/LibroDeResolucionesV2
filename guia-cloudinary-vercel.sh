#!/bin/bash

echo "ğŸ” GUÃA COMPLETA: CONFIGURACIÃ“N CLOUDINARY PARA VERCEL"
echo "====================================================="

echo ""
echo "ğŸ“ 1. ENCONTRAR CLOUD_NAME EN CLOUDINARY"
echo "========================================"
echo "ğŸŒ Ve a: https://console.cloudinary.com"
echo "ğŸ”‘ Inicia sesiÃ³n en tu cuenta"
echo "ğŸ“Š En el Dashboard principal, verÃ¡s:"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Account Details                     â”‚"
echo "   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚"
echo "   â”‚ Cloud name: tu_cloud_name_aqui      â”‚ â† ESTE ES EL VALOR"
echo "   â”‚ API Key: 123456789                  â”‚"
echo "   â”‚ API Secret: [Hidden]                â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "âœ… Copia el 'Cloud name' exactamente como aparece"
echo "ğŸ“ Ejemplo: si aparece 'dxy123abc', usa 'dxy123abc'"
echo ""

echo "ğŸ“ 2. CREAR/ENCONTRAR UPLOAD_PRESET"
echo "=================================="
echo "ğŸ”§ OpciÃ³n A - Crear nuevo Upload Preset:"
echo "1. En Cloudinary Dashboard â†’ Settings (âš™ï¸)"
echo "2. Clic en 'Upload' tab"
echo "3. Scroll hasta 'Upload presets'"
echo "4. Clic en 'Add upload preset'"
echo "5. Configurar:"
echo "   - Preset name: libro-resoluciones-preset"
echo "   - Signing Mode: Unsigned"
echo "   - Folder: libro-resoluciones"
echo "   - Resource type: Auto"
echo "6. Save"
echo ""
echo "ğŸ” OpciÃ³n B - Usar Upload Preset existente:"
echo "1. Settings â†’ Upload tab"
echo "2. En 'Upload presets' verÃ¡s una lista"
echo "3. Busca uno que sea 'Unsigned'"
echo "4. Copia el nombre exacto"
echo ""
echo "âš ï¸ IMPORTANTE: Debe ser 'Unsigned' para funcionar desde el frontend"
echo ""

echo "ğŸ“ 3. VERIFICAR CONFIGURACIÃ“N ACTUAL"
echo "=================================="
echo "ğŸ” Revisando archivos de configuraciÃ³n actuales..."

# Buscar referencias a Cloudinary en el cÃ³digo
if [ -f "server/config/cloudinary.js" ]; then
    echo "ğŸ“„ Encontrado: server/config/cloudinary.js"
    echo "   Cloud name actual:"
    grep -n "cloud_name" server/config/cloudinary.js | head -1
    echo ""
fi

if [ -f "front/.env" ]; then
    echo "ğŸ“„ Encontrado: front/.env"
    echo "   Variables actuales:"
    grep "CLOUDINARY\|VITE_CLOUDINARY" front/.env
    echo ""
elif [ -f ".env" ]; then
    echo "ğŸ“„ Encontrado: .env (raÃ­z)"
    echo "   Variables actuales:"
    grep "CLOUDINARY\|VITE_CLOUDINARY" .env
    echo ""
else
    echo "ğŸ“„ No se encontrÃ³ archivo .env"
fi

echo "ğŸ“ 4. CONFIGURAR EN VERCEL"
echo "========================="
echo "ğŸŒ Ve a: https://vercel.com/dashboard"
echo "ğŸ¯ Selecciona tu proyecto frontend"
echo "âš™ï¸ Settings â†’ Environment Variables"
echo "â• Add New Variable:"
echo ""
echo "Variable 1:"
echo "   Name: VITE_CLOUDINARY_CLOUD_NAME"
echo "   Value: [tu cloud_name de paso 1]"
echo "   Environment: Production, Preview, Development"
echo ""
echo "Variable 2:"
echo "   Name: VITE_CLOUDINARY_UPLOAD_PRESET"
echo "   Value: [tu upload_preset de paso 2]"
echo "   Environment: Production, Preview, Development"
echo ""

echo "ğŸ“ 5. CONFIGURACIÃ“N VITE_BUILD_OUTPUT"
echo "====================================="
echo "â„¹ï¸ VITE_BUILD_OUTPUT no es necesario configurar porque:"
echo "   - Vite usa 'dist' por defecto"
echo "   - Vercel detecta automÃ¡ticamente el build folder"
echo "   - Solo se necesita si cambias la configuraciÃ³n de build"
echo ""
echo "âœ… Para la mayorÃ­a de casos: NO necesitas VITE_BUILD_OUTPUT"
echo ""

echo "ğŸ“ 6. EJEMPLO DE CONFIGURACIÃ“N COMPLETA"
echo "======================================"
echo "En Vercel Environment Variables:"
echo ""
echo "VITE_API_URL=https://libroderesoluciones-api.onrender.com"
echo "VITE_CLOUDINARY_CLOUD_NAME=dxy123abc"
echo "VITE_CLOUDINARY_UPLOAD_PRESET=libro-resoluciones-preset"
echo "NODE_ENV=production"
echo ""

echo "ğŸ§ª VERIFICACIÃ“N"
echo "==============="
echo "DespuÃ©s de configurar, verifica que funciona:"
echo ""
echo "1. Redesplegar en Vercel"
echo "2. Abrir consola del navegador"
echo "3. Buscar logs como:"
echo "   'Cloudinary configurado con cloud_name: dxy123abc'"
echo "4. Probar subir una imagen"
echo ""

echo "ğŸ†˜ SOLUCIÃ“N DE PROBLEMAS"
echo "======================="
echo "âŒ Si aparece 'Upload preset not found':"
echo "   â†’ Verificar que el preset sea 'Unsigned'"
echo "   â†’ Usar el nombre exacto del preset"
echo ""
echo "âŒ Si aparece 'Invalid cloud_name':"
echo "   â†’ Copiar exactamente como aparece en Cloudinary"
echo "   â†’ No incluir espacios al inicio/final"
echo ""
echo "âŒ Si las variables no se cargan:"
echo "   â†’ Verificar que empiecen con 'VITE_'"
echo "   â†’ Redesplegar despuÃ©s de agregar variables"
echo ""

echo "âœ… ConfiguraciÃ³n completada siguiendo esta guÃ­a"
